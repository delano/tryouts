#!/usr/bin/env /Users/d/.rbenv/shims/ruby

require_relative '../lib/tryouts'

# Add development library paths
lib_glob = File.join(Dir.pwd, '{lib,../lib,.}')
Tryouts.update_load_path(lib_glob) if Tryouts.respond_to?(:update_load_path)

# Parse args and run CLI
begin
  files, options = Tryouts::CLI.parse_args(ARGV)

  # Default file discovery if no files specified
  if files.empty?
    files = Dir.glob(
      ['./{try,tryouts,.}/*_try.rb'],
      base: Dir.pwd,
    ).sort
  end

  cli = Tryouts::CLI.new
  exit cli.run(files, **options)

rescue StandardError => ex
  warn "Error: #{ex.message}"
  warn ex.backtrace.join("\n") if options[:debug]
  exit 1
end
