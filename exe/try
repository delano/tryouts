#!/usr/bin/env ruby

require_relative '../lib/tryouts'

# Add development library paths
lib_glob = File.join(Dir.pwd, '{lib,../lib,.}')
Tryouts.update_load_path(lib_glob) if Tryouts.respond_to?(:update_load_path)

# Parse args and run CLI
begin
  files, options = Tryouts::CLI.parse_args(ARGV)

  # Default file discovery if no files specified
  if files.empty?
    files = Dir.glob(
      ['./{try,tryouts/,.}/*_{try,tryouts}.rb'],
      base: Dir.pwd
    ).sort
  end

  exit Tryouts::CLI.new.run(files, **options)
rescue => e
  $stderr.puts "Error: #{e.message}"
  exit 1
end
